<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{#if post}}{{post.title}} - {{/if}}{{#if page}}{{page.title}} - {{/if}}{{site.name}}</title>
  <meta name="description" content="{{#if post}}{{post.excerpt}}{{else}}{{site.description}}{{/if}}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/themes/tester/assets/css/style.css">
  <style>
    .nav-actions { display: flex; align-items: center; gap: 1rem; }
    .nav-cart { position: relative; color: inherit; text-decoration: none; }
    .nav-cart svg { width: 24px; height: 24px; }
    .cart-badge { position: absolute; top: -8px; right: -8px; background: var(--color-primary, #6366F1); color: white; font-size: 0.7rem; font-weight: 600; padding: 2px 6px; border-radius: 10px; min-width: 18px; text-align: center; }
    .btn-login, .btn-register { padding: 0.5rem 1rem; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 0.9rem; transition: all 0.2s; }
    .btn-login { color: var(--color-text, #333); border: 1px solid var(--color-border, #ddd); background: transparent; }
    .btn-login:hover { background: var(--color-bg-alt, #f5f5f5); }
    .btn-register { background: var(--color-primary, #6366F1); color: white; border: none; }
    .btn-register:hover { opacity: 0.9; }
    .user-menu { position: relative; }
    .user-menu-btn { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 6px; background: transparent; border: none; cursor: pointer; color: inherit; }
    .user-menu-btn:hover { background: var(--color-bg-alt, #f5f5f5); }
    .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--color-primary, #6366F1); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.9rem; }
    .user-dropdown { position: absolute; top: 100%; right: 0; margin-top: 0.5rem; background: white; border: 1px solid var(--color-border, #ddd); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-width: 180px; display: none; z-index: 100; }
    .user-dropdown.open { display: block; }
    .user-dropdown a { display: block; padding: 0.75rem 1rem; color: var(--color-text, #333); text-decoration: none; }
    .user-dropdown a:hover { background: var(--color-bg-alt, #f5f5f5); }
    .user-dropdown .divider { border-top: 1px solid var(--color-border, #ddd); margin: 0.25rem 0; }
    .mobile-menu-btn { display: none; background: none; border: none; cursor: pointer; padding: 0.5rem; }
    @media (max-width: 768px) {
      .nav-menu { display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; flex-direction: column; padding: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
      .nav-menu.open { display: flex; }
      .mobile-menu-btn { display: block; }
      .nav-actions { gap: 0.5rem; }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="nav-wrapper">
        <a href="/" class="logo">{{site.name}}</a>

        <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>

        <div class="nav-menu" id="navMenu">
          {{#if menus.header}}
            {{#each menus.header.items}}
              <a href="{{this.url}}" class="nav-link" target="{{this.target}}">{{this.label}}</a>
            {{/each}}
          {{else}}
            <a href="/" class="nav-link">Home</a>
            <a href="/shop" class="nav-link">Shop</a>
            <a href="/courses" class="nav-link">Courses</a>
            <a href="/blog" class="nav-link">Blog</a>
          {{/if}}
        </div>

        <div class="nav-actions">
          <!-- Cart Icon -->
          <a href="/shop/cart" class="nav-cart" title="Shopping Cart">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            <span class="cart-badge cart-count" style="display: none;">0</span>
          </a>

          {{#if currentUser}}
            <!-- Logged in user menu -->
            <div class="user-menu">
              <button class="user-menu-btn" onclick="toggleUserMenu()">
                <div class="user-avatar">{{currentUser.initials}}</div>
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>
              <div class="user-dropdown" id="userDropdown">
                <a href="/admin/profile">My Profile</a>
                <a href="/admin/lms/dashboard">My Learning</a>
                <a href="/shop/orders">My Orders</a>
                {{#if currentUser.canCustomize}}
                <div class="divider"></div>
                <a href="/admin">Admin Dashboard</a>
                {{/if}}
                <div class="divider"></div>
                <a href="#" onclick="logout(); return false;">Sign Out</a>
              </div>
            </div>
          {{else}}
            <!-- Guest user - show login/register -->
            <a href="/admin/login" class="btn-login">Sign In</a>
            <a href="/admin/register" class="btn-register">Register</a>
          {{/if}}
        </div>
      </div>
    </div>
  </nav>

  <script>
    function toggleMobileMenu() {
      document.getElementById('navMenu').classList.toggle('open');
    }
    function toggleUserMenu() {
      document.getElementById('userDropdown').classList.toggle('open');
    }
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.user-menu')) {
        var dropdown = document.getElementById('userDropdown');
        if (dropdown) dropdown.classList.remove('open');
      }
    });
    function logout() {
      localStorage.removeItem('token');
      document.cookie = 'token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
      window.location.href = '/admin/login';
    }
    // Load cart count
    (function() {
      fetch('/api/shop/cart', { credentials: 'include' })
        .then(r => r.json())
        .then(cart => {
          if (cart && cart.items && cart.items.length > 0) {
            var count = cart.items.reduce((sum, item) => sum + item.quantity, 0);
            var badge = document.querySelector('.cart-count');
            if (badge) {
              badge.textContent = count;
              badge.style.display = 'block';
            }
          }
        })
        .catch(() => {});
    })();
  </script>

  <main class="main-content">
