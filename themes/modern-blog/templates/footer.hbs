  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3 class="footer-title">{{site.name}}</h3>
          <p class="footer-description">{{site.description}}</p>
        </div>
        
        <div class="footer-section">
          <h4 class="footer-heading">Quick Links</h4>
          <ul class="footer-links">
            {{#if menus.footer}}
              {{#each menus.footer.items}}
                <li><a href="{{this.url}}" target="{{this.target}}">{{this.label}}</a></li>
              {{/each}}
            {{else}}
              <li><a href="/">Home</a></li>
              <li><a href="/blog">Blog</a></li>
              <li><a href="/about">About</a></li>
              <li><a href="/contact">Contact</a></li>
            {{/if}}
          </ul>
        </div>
        
        <div class="footer-section">
          <h4 class="footer-heading">Follow Us</h4>
          <div class="social-links">
            <a href="#" class="social-link" aria-label="Twitter">
              <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"></path></svg>
            </a>
            <a href="#" class="social-link" aria-label="GitHub">
              <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
            <a href="#" class="social-link" aria-label="LinkedIn">
              <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
            </a>
          </div>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; {{year}} {{site.name}}. All rights reserved. Powered by <a href="https://github.com/wordpress-node" target="_blank">WordPress Node</a></p>
      </div>
    </div>
  </footer>

  <!-- Theme Scripts -->
  <script src="/themes/modern-blog/assets/js/main.js"></script>

  <!-- Theme Customizer Live Preview Script -->
  <script>
    (function() {
      // Only run if we're in an iframe (Theme Customizer preview)
      if (window.parent === window) return;

      // Create or get the customizer styles element
      let customizerStyleEl = document.getElementById('customizer-preview-styles');
      if (!customizerStyleEl) {
        customizerStyleEl = document.createElement('style');
        customizerStyleEl.id = 'customizer-preview-styles';
        document.head.appendChild(customizerStyleEl);
      }

      // Create or get the custom CSS element
      let customCSSEl = document.getElementById('customizer-custom-css');
      if (!customCSSEl) {
        customCSSEl = document.createElement('style');
        customCSSEl.id = 'customizer-custom-css';
        document.head.appendChild(customCSSEl);
      }

      // Track element inspector state
      let inspectorEnabled = false;
      let hoveredElement = null;
      let selectedElement = null;
      const highlightOverlay = document.createElement('div');
      highlightOverlay.id = 'customizer-highlight-overlay';
      highlightOverlay.style.cssText = 'position:fixed;pointer-events:none;border:2px solid #3B82F6;background:rgba(59,130,246,0.1);z-index:999999;display:none;transition:all 0.1s ease;';
      document.body.appendChild(highlightOverlay);

      const selectedOverlay = document.createElement('div');
      selectedOverlay.id = 'customizer-selected-overlay';
      selectedOverlay.style.cssText = 'position:fixed;pointer-events:none;border:2px dashed #EF4444;background:rgba(239,68,68,0.05);z-index:999998;display:none;';
      document.body.appendChild(selectedOverlay);

      // Element inspector mouse handlers
      function handleMouseOver(e) {
        if (!inspectorEnabled) return;
        hoveredElement = e.target;
        const rect = e.target.getBoundingClientRect();
        highlightOverlay.style.display = 'block';
        highlightOverlay.style.top = rect.top + 'px';
        highlightOverlay.style.left = rect.left + 'px';
        highlightOverlay.style.width = rect.width + 'px';
        highlightOverlay.style.height = rect.height + 'px';
      }

      function handleMouseOut(e) {
        if (!inspectorEnabled) return;
        highlightOverlay.style.display = 'none';
      }

      function handleClick(e) {
        if (!inspectorEnabled) return;
        e.preventDefault();
        e.stopPropagation();
        selectedElement = e.target;
        const rect = e.target.getBoundingClientRect();
        selectedOverlay.style.display = 'block';
        selectedOverlay.style.top = rect.top + 'px';
        selectedOverlay.style.left = rect.left + 'px';
        selectedOverlay.style.width = rect.width + 'px';
        selectedOverlay.style.height = rect.height + 'px';

        // Get computed styles
        const computed = window.getComputedStyle(e.target);
        const elementInfo = {
          tagName: e.target.tagName.toLowerCase(),
          id: e.target.id,
          className: e.target.className,
          text: e.target.innerText?.substring(0, 50),
          styles: {
            color: computed.color,
            backgroundColor: computed.backgroundColor,
            fontSize: computed.fontSize,
            fontFamily: computed.fontFamily,
            fontWeight: computed.fontWeight,
            margin: computed.margin,
            padding: computed.padding,
            borderRadius: computed.borderRadius,
          }
        };
        window.parent.postMessage({ type: 'ELEMENT_SELECTED', element: elementInfo }, '*');
      }

      // Listen for messages from parent (Theme Customizer)
      window.addEventListener('message', function(event) {
        // Validate message origin in production
        const data = event.data;
        if (!data || typeof data !== 'object') return;

        switch (data.type) {
          case 'CUSTOMIZER_UPDATE_STYLES':
            // Apply CSS from customizer
            if (data.css) {
              customizerStyleEl.textContent = data.css;
            }
            break;

          case 'CUSTOMIZER_UPDATE_CUSTOM_CSS':
            // Apply custom CSS
            if (typeof data.customCSS === 'string') {
              customCSSEl.textContent = data.customCSS;
            }
            break;

          case 'CUSTOMIZER_TOGGLE_INSPECTOR':
            inspectorEnabled = data.enabled;
            document.body.style.cursor = inspectorEnabled ? 'crosshair' : '';
            if (!inspectorEnabled) {
              highlightOverlay.style.display = 'none';
              selectedOverlay.style.display = 'none';
              selectedElement = null;
            }
            break;

          case 'CUSTOMIZER_SCROLL_TO':
            if (data.selector) {
              const el = document.querySelector(data.selector);
              if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            break;

          case 'CUSTOMIZER_PING':
            // Respond to ping from customizer to confirm connection
            window.parent.postMessage({ type: 'CUSTOMIZER_PONG' }, '*');
            break;

          case 'CUSTOMIZER_LOAD_FONT':
            // Dynamically load a Google Font
            if (data.font) {
              const fontName = data.font.replace(/ /g, '+');
              const linkId = 'google-font-' + fontName;
              if (!document.getElementById(linkId)) {
                const link = document.createElement('link');
                link.id = linkId;
                link.rel = 'stylesheet';
                link.href = 'https://fonts.googleapis.com/css2?family=' + fontName + ':wght@300;400;500;600;700;800&display=swap';
                document.head.appendChild(link);
              }
            }
            break;
        }
      });

      // Add event listeners for element inspector
      document.addEventListener('mouseover', handleMouseOver, true);
      document.addEventListener('mouseout', handleMouseOut, true);
      document.addEventListener('click', handleClick, true);

      // Notify parent that preview is ready
      window.parent.postMessage({ type: 'CUSTOMIZER_READY' }, '*');
    })();
  </script>

  <!-- Admin Bar Script - Shows customize button for ADMIN/EDITOR users -->
  <script>
    (function() {
      try {
        // Check localStorage for auth data (same key as React admin)
        const authData = localStorage.getItem('auth-storage');
        if (!authData) return;

        const parsed = JSON.parse(authData);
        const user = parsed?.state?.user;

        // Only show for ADMIN or EDITOR roles
        if (user && (user.role === 'ADMIN' || user.role === 'EDITOR')) {
          const adminBar = document.getElementById('admin-bar');
          const userInfo = document.getElementById('admin-bar-user');

          if (adminBar) {
            adminBar.classList.add('visible');
            document.body.classList.add('has-admin-bar');
          }

          if (userInfo) {
            userInfo.textContent = 'Logged in as ' + user.name + ' (' + user.role + ')';
          }

          // Set admin panel URLs - detect if running on different port (dev) or same origin (production)
          // In development, admin panel is on port 5173; in production it might be on same origin
          const adminBase = window.location.port === '3000' ? 'http://localhost:5173' : '';
          const setLink = (id, path) => {
            const el = document.getElementById(id);
            if (el) el.href = adminBase + path;
          };
          setLink('admin-link-dashboard', '/admin');
          setLink('admin-link-posts', '/admin/posts');
          setLink('admin-link-pages', '/admin/pages');
          setLink('admin-link-customize', '/admin/customize');
          setLink('admin-link-settings', '/admin/settings');
        }
      } catch (e) {
        // Silently fail if localStorage is not available or data is invalid
      }
    })();
  </script>
</body>
</html>

