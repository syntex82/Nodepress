{{> header}}
<div class="page-content">
  <div class="container">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
      <div>
        {{#if product.images.[0]}}
        <img src="{{product.images.[0]}}" alt="{{product.name}}" style="width: 100%; border-radius: var(--border-radius);">
        {{/if}}
      </div>
      <div>
        <h1>{{product.name}}</h1>
        <p style="font-size: 1.5rem; color: var(--color-primary); font-weight: 600; margin-bottom: 1rem;">
          {{#if product.salePrice}}<s style="color: var(--color-text-muted);">${{product.price}}</s> ${{product.salePrice}}{{else}}${{product.price}}{{/if}}
        </p>
        <div class="post-body">{{{product.description}}}</div>

        <div style="display: flex; align-items: center; gap: 1rem; margin-top: 1.5rem;">
          <div style="display: flex; align-items: center; border: 1px solid var(--color-border); border-radius: var(--border-radius);">
            <button type="button" onclick="decreaseQty()" style="padding: 0.5rem 1rem; border: none; background: none; cursor: pointer; font-size: 1.2rem;">−</button>
            <input type="number" id="quantity" value="1" min="1" max="{{#if product.stock}}{{product.stock}}{{else}}99{{/if}}" style="width: 50px; text-align: center; border: none; font-size: 1rem;">
            <button type="button" onclick="increaseQty()" style="padding: 0.5rem 1rem; border: none; background: none; cursor: pointer; font-size: 1.2rem;">+</button>
          </div>
          <button class="btn btn-primary add-to-cart" onclick="addToCart('{{product.id}}')" style="flex: 1;">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 0.5rem;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            Add to Cart
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function decreaseQty() {
  const input = document.getElementById('quantity');
  if (parseInt(input.value) > 1) input.value = parseInt(input.value) - 1;
}
function increaseQty() {
  const input = document.getElementById('quantity');
  const max = parseInt(input.max) || 99;
  if (parseInt(input.value) < max) input.value = parseInt(input.value) + 1;
}
function addToCart(productId) {
  const qty = parseInt(document.getElementById('quantity').value) || 1;
  const btn = document.querySelector('.add-to-cart');
  const originalText = btn.innerHTML;
  btn.innerHTML = 'Adding...';
  btn.disabled = true;

  fetch('/api/shop/cart/add', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    credentials: 'include',
    body: JSON.stringify({ productId: productId, quantity: qty })
  })
  .then(response => {
    if (!response.ok) throw new Error('Failed to add to cart');
    return response.json();
  })
  .then(cart => {
    btn.innerHTML = '✓ Added!';
    btn.style.background = '#10B981';
    setTimeout(() => {
      btn.innerHTML = originalText;
      btn.style.background = '';
      btn.disabled = false;
    }, 2000);
  })
  .catch(err => {
    console.error('Add to cart error:', err);
    btn.innerHTML = '✗ Error';
    btn.style.background = '#EF4444';
    setTimeout(() => {
      btn.innerHTML = originalText;
      btn.style.background = '';
      btn.disabled = false;
    }, 2000);
  });
}
</script>
{{> footer}}
