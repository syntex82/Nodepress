(function(){
  'use strict';
  var loginForm=document.getElementById('loginForm');
  if(loginForm){loginForm.addEventListener('submit',async function(e){e.preventDefault();var btn=document.getElementById('submitBtn'),txt=btn.querySelector('.btn-text'),load=btn.querySelector('.btn-loading');txt.style.display='none';load.style.display='inline';btn.disabled=true;var fd=new FormData(loginForm);try{var r=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:fd.get('email'),password:fd.get('password')}),credentials:'include'});var d=await r.json();if(r.ok){localStorage.setItem('access_token',d.access_token);window.location.href=new URLSearchParams(window.location.search).get('redirect')||'/';}else{showError(loginForm,d.message||'Invalid email or password');resetBtn(btn,txt,load);}}catch(e){showError(loginForm,'An error occurred');resetBtn(btn,txt,load);}});}
  var regForm=document.getElementById('registerForm');
  if(regForm){regForm.addEventListener('submit',async function(e){e.preventDefault();var btn=document.getElementById('submitBtn'),txt=btn.querySelector('.btn-text'),load=btn.querySelector('.btn-loading');var fd=new FormData(regForm);if(fd.get('password')!==fd.get('confirmPassword')){showError(regForm,'Passwords do not match');return;}txt.style.display='none';load.style.display='inline';btn.disabled=true;try{var r=await fetch('/api/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:fd.get('name'),email:fd.get('email'),password:fd.get('password')}),credentials:'include'});var d=await r.json();if(r.ok){var lr=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:fd.get('email'),password:fd.get('password')}),credentials:'include'});if(lr.ok){var ld=await lr.json();localStorage.setItem('access_token',ld.access_token);window.location.href='/';}else{window.location.href='/login';}}else{showError(regForm,d.message||'Registration failed');resetBtn(btn,txt,load);}}catch(e){showError(regForm,'An error occurred');resetBtn(btn,txt,load);}});}
  function showError(f,m){var a=f.querySelector('.alert-error');if(!a){a=document.createElement('div');a.className='alert alert-error';f.insertBefore(a,f.firstChild);}a.textContent=m;}
  function resetBtn(b,t,l){t.style.display='inline';l.style.display='none';b.disabled=false;}
})();